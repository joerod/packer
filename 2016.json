{
  "builders": [
      {
          "type": "hyperv-iso",
          "output_directory": "./output-{{ user `os_name` }}-base-hyperv/",
          "vm_name": "{{ user `os_name` }}-base",
          "iso_url": "{{ user `iso_url` }}",
          "iso_checksum": "{{ user `iso_checksum` }}",
          "iso_checksum_type": "sha256",
          "communicator": "winrm",
          "winrm_username":  "{{ user `winrm_username` }}",
          "winrm_password":  "{{ user `winrm_password` }}",
          "winrm_timeout": "12h",
          "winrm_insecure": "true",
          "switch_name": "packer-hyperv-iso",
          "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
          "shutdown_timeout": "15m",
          "floppy_files": [
            "answer_files/2016/Autounattend.xml",
            "scripts/winrm.ps1"
          ],
          "iso_target_path": "C:\\Users\\joero\\Desktop\\packer\\iso\\",
          "cpu": 1,
          "disk_size": 81920,
          "ram_size": 8096,
          "generation": "{{ user `hyperv_gen` }}",
          "headless": "true",
          "skip_export": "true" 
      },
      {
        "type": "amazon-ebs",
        "access_key": "{{ user `access_key` }}",
        "secret_key": "{{ user `secret_key` }}",
        "region": "{{ user `region` }}",
        "source_ami": "{{ user `source_ami` }}",
        "security_group_id": "sg-0a41bd1420bb0e2a8",
        "instance_type": "m3.medium",
        "ami_name": "packer-quick-start {{timestamp}}",
        "user_data_file":"scripts/winrm.txt",
        "communicator": "winrm",
        "winrm_insecure": true,
        "winrm_username": "Administrator",
        "winrm_port": 5985,
	    "winrm_timeout": "10m"
        }
  ],
  "provisioners": [
    {
        "type": "powershell",
        "script": "scripts/rdpenable.ps1"
    },
    {
        "type": "powershell",
        "script": "scripts/chocolatey.ps1"
    },
    {
        "type": "windows-shell",
        "inline": ["C:\\ProgramData\\chocolatey\\bin\\choco.exe install chocolatey-core.extension -y"]
    },
    {
        "type": "file",
        "source": "scripts/bootstrap.ps1",
        "destination": "C:\\Program Files\\joerod\\bootstrap.ps1"
    },
    {
        "type": "powershell",
        "script": "scripts/patch.ps1",
        "elevated_user": "{{ user `winrm_username` }}",
        "elevated_password": "{{ user `winrm_password` }}"
    },
    {
        "type": "windows-restart",
        "restart_timeout": "45m"
    },
    {
        "type": "windows-restart",
        "restart_timeout": "30m"
    }
],
  "variables": {
      "os_name": "2016",
      "iso_checksum": "1CE702A578A3CB1AC3D14873980838590F06D5B7101C5DAACCBAC9D73F1FB50F",
      "iso_url": "C:\\Users\\joero\\Desktop\\packer\\iso\\Windows_Server_2016_Datacenter_EVAL_en-us_14393_refresh.ISO",
      "hyperv_gen": "1",
      "source_ami": "ami-2d360152",
      "region": "us-east-1"
  }
}